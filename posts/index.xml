<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Posts on Gannicus's Blog</title><link>https://gannikus.github.io/posts/</link><description>Recent content in Posts on Gannicus's Blog</description><generator>Hugo</generator><language>zh-cn</language><lastBuildDate>Mon, 03 Nov 2025 10:55:00 +0000</lastBuildDate><atom:link href="https://gannikus.github.io/posts/index.xml" rel="self" type="application/rss+xml"/><item><title>解决命令行无法通过VPN代理访问网络的问题!</title><link>https://gannikus.github.io/posts/2025-11-04-%E8%A7%A3%E5%86%B3%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%97%A0%E6%B3%95%E9%80%9A%E8%BF%87vpn%E4%BB%A3%E7%90%86%E8%AE%BF%E9%97%AE%E7%BD%91%E7%BB%9C%E7%9A%84%E9%97%AE%E9%A2%98/</link><pubDate>Mon, 03 Nov 2025 10:55:00 +0000</pubDate><guid>https://gannikus.github.io/posts/2025-11-04-%E8%A7%A3%E5%86%B3%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%97%A0%E6%B3%95%E9%80%9A%E8%BF%87vpn%E4%BB%A3%E7%90%86%E8%AE%BF%E9%97%AE%E7%BD%91%E7%BB%9C%E7%9A%84%E9%97%AE%E9%A2%98/</guid><description>&lt;h1 id="解决在windows上命令行无法通过vpn代理访问网络的问题"&gt;解决在Windows上命令行无法通过VPN代理访问网络的问题&lt;/h1&gt;
&lt;h2 id="问题描述"&gt;问题描述&lt;/h2&gt;
&lt;p&gt;当VPN开启时，网页浏览器可以正常访问Google等网站，但在命令行（CMD）或PowerShell中，&lt;code&gt;ping&lt;/code&gt;、&lt;code&gt;curl&lt;/code&gt; 等工具无法访问这些网站，通常表现为连接超时。&lt;/p&gt;
&lt;p&gt;这通常是因为VPN客户端默认只代理了浏览器或特定应用的流量（分裂隧道模式），而没有为整个系统或命令行环境设置全局代理。&lt;/p&gt;
&lt;h2 id="解决步骤"&gt;解决步骤&lt;/h2&gt;
&lt;h3 id="1-初步诊断"&gt;1. 初步诊断&lt;/h3&gt;
&lt;p&gt;首先，我们确认问题确实存在于命令行环境中。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;测试外部连接 (Google):&lt;/strong&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;ping google.com
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# 结果: 100%丢包，请求超时&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;测试内部连接 (Baidu):&lt;/strong&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;ping baidu.com
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# 结果: 成功接收数据，延迟正常&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;结论:&lt;/strong&gt; 网络本身是通的，但命令行无法访问被限制的网站，问题指向代理设置。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="2-检查系统代理设置"&gt;2. 检查系统代理设置&lt;/h3&gt;
&lt;p&gt;我们检查Windows系统级别的代理设置，看是否有为命令行工具配置代理。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;使用 &lt;code&gt;netsh&lt;/code&gt; 命令检查:&lt;/strong&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;netsh winhttp show proxy
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;���型的问题输出:&lt;/strong&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;当前的 WinHTTP 代理服务器设置:

 直接访问(没有代理服务器)。
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;结论:&lt;/strong&gt; 系统并未配置全局代理，这解释了为什么命令行工具无法通过VPN。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="3-寻找并测试vpn代理"&gt;3. 寻找并测试VPN代理&lt;/h3&gt;
&lt;p&gt;多数VPN客户端会在本地启动一个HTTP或SOCKS5代理服务。我们需要找到这个服务的地址和端口，并进行测试。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;常见的本地代理地址:&lt;/strong&gt; &lt;code&gt;127.0.0.1&lt;/code&gt; (或 &lt;code&gt;localhost&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;常见的代理端口:&lt;/strong&gt; &lt;code&gt;7890&lt;/code&gt;, &lt;code&gt;1080&lt;/code&gt;, &lt;code&gt;10809&lt;/code&gt;, &lt;code&gt;8888&lt;/code&gt; 等 (具体请在您的VPN客户端设置中查找)。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;我们使用 &lt;code&gt;curl&lt;/code&gt; 命令直接指定代理进行测试，这是最关键的一步。假设通过VPN客户端查到代理是SOCKS5类型，地址是 &lt;code&gt;127.0.0.1:7890&lt;/code&gt;。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;使用 &lt;code&gt;curl&lt;/code&gt; 指定SOCKS5代理进行测试:&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;curl -v --socks5 127.0.0.1:7890 https://www.google.com
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;成功的标志:&lt;/strong&gt;
您会看到 &lt;code&gt;* SOCKS5 request granted.&lt;/code&gt; 和 &lt;code&gt;* Connected to 127.0.0.1 ...&lt;/code&gt; 等信息，最后是Google服务器返回的HTTP响应（例如 &lt;code&gt;HTTP/1.1 301 Moved Permanently&lt;/code&gt; 或 &lt;code&gt;HTTP/2 200&lt;/code&gt;）。&lt;/p&gt;</description></item></channel></rss>